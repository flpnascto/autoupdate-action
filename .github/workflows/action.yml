on:
  pull_request:
    types:
      - closed
    branches:
      - 'main'

# jobs:
#   autoupdate:
#     if: github.event.pull_request.merged == true
#     name: autoupdate
#     runs-on: ubuntu-22.04
#     steps:
#       - uses: docker://chinthakagodawita/autoupdate-action:v1
#         env:
#           GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
#           DRY_RUN: "false"
#           # PR_FILTER: "labelled"
#           # PR_LABELS: "autoupdate,keep up-to-date,integration"
#           # EXCLUDED_LABELS: "dependencies,wontfix"
#           MERGE_MSG: "Branch was auto-updated."
#           RETRY_COUNT: "5"
#           RETRY_SLEEP: "300"
#           MERGE_CONFLICT_ACTION: "fail"

jobs:
  autoupdate:
    name: autoupdate
    runs-on: ubuntu-18.04
    steps:
      - uses: docker://chinthakagodawita/autoupdate:v1.7.0
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
          PR_FILTER: "labelled"
          PR_LABELS: "autoupdate"
          MERGE_CONFLICT_ACTION: "ignore"

      - run: echo 'Merge conflicts found!'
        if: ${{ steps.autoupdate.outputs.conflicted }}

      - run: echo 'No merge conflicts'
        if: ${{ !steps.autoupdate.outputs.conflicted }}